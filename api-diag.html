<!DOCTYPE html>
<html>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: "Source Sans Pro", sans-serif;
        }

        dt {
            float: left;
            width: 20%;
            padding: .25em;
            clear: left;
        }

        dd {
            padding: .25em 0;
        }

        h4 {
            margin: .25em 0;
        }

        #context, #value {
            float: left;
            width: 50%;
        }

        #config {
            clear: both;
        }
    </style>
</head>

<body>
    <div id="actions">
        <input id="btnExpand" type="button" value="Expand" />
        <input id="btnCollapse" type="button" value="Collapse" />
    </div>
    <div id="context">
        <h4>Context</h4>
        <dl>
            <dt>Disabled</dt>
            <dd id="lblDisabled"></dd>
            <dt>Project id</dt>
            <dd id="lblProjectId"></dd>
            <dt>Item id</dt>
            <dd id="lblItemId"></dd>
            <dt>Variant id</dt>
            <dd id="lblVariantId"></dd>
        </dl>
    </div>
    <div id="value">
        <h4>Value</h4>
        <input id="btnSendNull" type="button" value="Send null" />
        <input id="btnSend100messages" type="button" value="Send 100 updates" />
        <input id="btnSendTimestamp" type="button" value="Send timestamp" />
        <br />
        <textarea id="txtValue" rows="4" cols="50"></textarea>
    </div>
    <div id="config">
        <h4>Config</h4>
        <pre id="lblConfig"></pre>
    </div>
    <script>
        function sendValue(value) {
            console.log("Sending: " + value);
            CustomElement.setValue(value);
        }
        function setHeight(height) {
            console.log("Setting height: " + height);
            CustomElement.setHeight(height);
        }
        function handleOnDisabledChanged(disabled) {
            console.log("onDisabledChanged received: " + disabled);
            displayDisabled(disabled);
        }

        function displayValue(value) {
            $("#txtValue").val(value);
        }
        function displayDisabled(disabled) {
            $("#lblDisabled").text(disabled);
        }
        function displayConfig(config) {
            var configString = JSON.stringify(config, null, 2);
            $("#lblConfig").text(configString);
        }
        function displayContext(context) {
            $("#lblProjectId").text(context.projectId);
            $("#lblItemId").text(context.item.id);
            $("#lblVariantId").text(context.variantId);
        }

        function init() {
            $("#txtValue").keyup(function () {
                var value = $(this).val();
                sendValue(value);
            });

            $("#btnSendNull").click(function () {
                sendValue(null);
                displayValue(null);
            });

            $("#btnSendTimestamp").click(function () {
                var now = new Date();
                var nowString = now.toISOString();
                sendValue(nowString);
                displayValue(nowString);
            });

            $("#btnSend100messages").click(function () {
                var value = null;
                for (var i = 1; i <= 100; i++) {
                    value = "Update " + i;
                    sendValue(value);
                }
                displayValue(value);
            });

            $("#btnExpand").click(function () {
                var height = $("html").height()
                setHeight(height);
            });
            $("#btnCollapse").click(function () {
                setHeight(32);
            });
        }

        init();
        // Load custom element js api and init the custom element
        var apiUrl = new URLSearchParams(window.location.search).get('apiUrl') || 'http://localhost:3000/js-api/custom-element.js';
        $.getScript(apiUrl, () => {
            CustomElement.init((el, _ctx) => {
                console.log("Init: " + JSON.stringify(el));
                displayValue(el.value);
                displayConfig(el.config);
                displayDisabled(el.disabled);
                displayContext(_ctx);
            });
            CustomElement.onDisabledChanged(handleOnDisabledChanged);
        })
    </script>
</body>

</html>